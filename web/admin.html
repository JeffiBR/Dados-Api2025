<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Controle - Coleta</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="auth.js"></script>
</head>
<body>
    <script>routeGuard('coleta');</script>

    <button class="mobile-menu-button">‚ò∞</button>

    <aside class="sidebar">
        <div class="sidebar-header"><h1>Pre√ßos AL</h1></div>
        <nav class="sidebar-nav">
            <ul>
                <li class="nav-header">AN√ÅLISE</li>
                <li><a href="/search.html"><span>üè†</span> Busca</a></li>
                <li data-permission="compare"><a href="/compare.html"><span>üìä</span> Comparador</a></li>
                <li data-permission="das
                hboard"><a href="/dashboard.html"><span>üìà</span> Dashboard</a></li>
                
                <li class="nav-header">ADMINISTRA√á√ÉO</li>
                <li data-permission="coleta"><a href="/admin.html" class="active"><span>‚öôÔ∏è</span> Coleta</a></li>
                <li data-permission="collections"><a href="/collections.html"><span>üóÇÔ∏è</span> Hist√≥rico de Coletas</a></li>
                <li data-permission="product_log"><a href="/product-log.html"><span>üìú</span> Log de Produtos</a></li>
                <li data-permission="prune"><a href="/prune.html"><span>üóëÔ∏è</span> Limpeza de Dados</a></li>

                <li class="nav-header">CONFIGURA√á√ÉO</li>
                <li data-permission="markets"><a href="/markets.html"><span>üõí</span> Gerenciar Mercados</a></li>
                <li data-permission="users"><a href="/users.html"><span>üë•</span> Gerenciar Usu√°rios</a></li>
            </ul>
        </nav>
        <div class="theme-switcher">
            <span>Tema</span><button id="themeToggle">Mudar</button>
        </div>
    </aside>

    <div class="content-wrapper">
        <header class="top-bar">
            <div id="userProfileMenu" class="profile-menu" style="display: none;">
                <img src="https://via.placeholder.com/40" alt="Avatar" id="userAvatar">
                <span id="userName">Usu√°rio</span>
                <div class="profile-dropdown">
                    <a href="/profile.html">Meu Perfil</a>
                    <a href="#" id="logoutButton">Sair</a>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="admin-panel">
                <h2>Coleta de Dados</h2>
                <p>Inicie a coleta de dados de todos os supermercados cadastrados no sistema.</p>
                <button id="startButton">Iniciar Coleta Manual</button>
                
                <div id="progress-container" class="status-box" style="display: none;">
                    <h3>Coleta em Andamento...</h3>
                    <div class="progress-bar-container">
                        <div id="progressBar" class="progress-bar"></div>
                    </div>
                    <div class="progress-details">
                        <span id="progressPercentText">0%</span>
                        <span id="etaText">ETA: Calculando...</span>
                    </div>
                    <p id="progressText">Iniciando...</p>
                    <p><strong>Itens Encontrados at√© agora:</strong> <span id="itemsFoundText">0</span></p>
                </div>

                <div id="report-container" class="table-container" style="display: none; margin-top: 2rem; text-align: left;">
                    <h3>Relat√≥rio da √öltima Coleta</h3>
                    <div class="summary-cards" style="grid-template-columns: 1fr 1fr; margin-bottom: 1rem;">
                        <div class="card"><h3>Total Salvo</h3><p id="report-total-items"></p></div>
                        <div class="card"><h3>Dura√ß√£o</h3><p id="report-duration"></p></div>
                    </div>
                    <h4>Detalhes por Mercado:</h4>
                    <table id="reportTable">
                        <thead>
                            <tr>
                                <th>Mercado</th>
                                <th>Itens Salvos</th>
                                <th>Dura√ß√£o (segundos)</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    
    <script src="admin.js"></script>
</body>
</html>
