<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8"><title>Dashboard Anal√≠tico</title><link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="auth.js"></script>
    <script src="notifications.js"></script>
</head>
<body>
    <script>routeGuard('dashboard');</script>

    <button class="mobile-menu-button">‚ò∞</button>
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>Pre√ßos AL</h1>
            <div class="sidebar-subtitle">Sistema de Monitoramento</div>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li class="nav-section">
                    <div class="nav-section-title">Pesquisa</div>
                    <ul>
                        <li><a href="/search.html"><span>üè†</span> Busca</a></li>
                        <li data-permission="compare"><a href="/compare.html"><span>üìä</span> Comparador</a></li>
                    </ul>
                </li>
                <li class="nav-section">
                    <div class="nav-section-title">An√°lise</div>
                    <ul>
                        <li data-permission="dashboard"><a href="/dashboard.html" class="active"><span>üìà</span> Dashboard</a></li>
                        <li data-permission="product_log"><a href="/product-log.html"><span>üìú</span> Log de Produtos</a></li>
                    </ul>
                </li>
                <li class="nav-section">
                    <div class="nav-section-title">Administra√ß√£o</div>
                    <ul>
                        <li data-permission="coleta"><a href="/admin.html"><span>‚öôÔ∏è</span> Coleta</a></li>
                        <li data-permission="markets"><a href="/markets.html"><span>üõí</span> Mercados</a></li>
                        <li data-permission="collections"><a href="/collections.html"><span>üóÇÔ∏è</span> Hist√≥rico</a></li>
                        <li data-permission="prune"><a href="/prune.html"><span>üóëÔ∏è</span> Limpeza</a></li>
                        <li data-permission="users"><a href="/users.html"><span>üë•</span> Usu√°rios</a></li>
                        <li data-permission="users"><a href="/categories.html"><span>üè∑Ô∏è</span> Gerenciar Categorias</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
        <div class="theme-switcher"><span>Tema</span><button id="themeToggle">Mudar</button></div>
    </aside>

    <div class="content-wrapper">
        <header class="top-bar">
            <div id="userProfileMenu" class="profile-menu" style="display: none;">
                <img src="https://via.placeholder.com/40" alt="Avatar" id="userAvatar">
                <div class="user-info">
                    <span class="user-name" id="userName">Usu√°rio</span>
                    <span class="user-role" id="userRole">Administrador</span>
                </div>
                <div class="profile-dropdown">
                    <a href="/profile.html">Meu Perfil</a>
                    <a href="#" id="logoutButton">Sair</a>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="filter-bar">
                <div class="form-group">
                    <label>Supermercados (Opcional)</label>
                    <div id="marketFilters" class="supermarket-list-row"></div>
                </div>
                <div class="form-group">
                    <label for="startDate">Per√≠odo De:</label>
                    <input type="date" id="startDate">
                </div>
                <div class="form-group">
                    <label for="endDate">At√©:</label>
                    <input type="date" id="endDate">
                </div>
                <button id="applyFiltersBtn">Aplicar Filtros</button>
            </div>

            <div class="summary-cards">
                <div class="card"><h3>Mercados</h3><p id="total-mercados">...</p></div>
                <div class="card"><h3>Produtos Coletados</h3><p id="total-produtos">...</p></div>
                <div class="card"><h3>Coletas Realizadas</h3><p id="total-coletas">...</p></div>
                <div class="card"><h3>√öltima Coleta</h3><p id="ultima-coleta">...</p></div>
            </div>

            <div class="dashboard-grid">
                <div class="chart-container">
                    <div class="chart-header">
                        <h2>Top 10 Produtos Buscados</h2>
                        <div class="chart-toggles" id="toggles-products"></div>
                    </div>
                    <canvas id="topProductsChart"></canvas>
                </div>
                <div class="chart-container">
                     <div class="chart-header">
                        <h2>Top 10 Mercados Selecionados</h2>
                        <div class="chart-toggles" id="toggles-markets"></div>
                    </div>
                    <canvas id="topMarketsChart"></canvas>
                </div>
            </div>

            <div class="table-container">
                <h2>Ca√ßa-Ofertas: Produtos Mais Baratos</h2>
                <p>Compara produtos id√™nticos e mostra onde encontrar o menor pre√ßo no per√≠odo e mercados selecionados.</p>
                <div class="category-filters"></div>
                <table id="bargainsTable">
                    <thead><tr><th>Produto</th><th>Menor Pre√ßo</th><th>Supermercado</th><th>Data da Venda</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </main>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>